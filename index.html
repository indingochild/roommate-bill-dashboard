<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Debt Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, setDoc, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration - using a demo project
        const firebaseConfig = {
            apiKey: "AIzaSyDemo-Replace-With-Your-Key",
            authDomain: "debt-tracker-demo.firebaseapp.com",
            projectId: "debt-tracker-demo",
            storageBucket: "debt-tracker-demo.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:demo"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.db = db;
        window.firestore = { collection, addDoc, onSnapshot, deleteDoc, doc, setDoc, getDocs, query, orderBy };
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .realtime-status {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #fff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .debt-banner {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            text-align: center;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .setup-section {
            background: white;
            margin: 20px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .setup-section.hidden {
            display: none;
        }

        .room-code-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            border: 2px dashed #007bff;
        }

        .room-code {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            font-family: 'Courier New', monospace;
            letter-spacing: 3px;
            margin: 10px 0;
        }

        .manual-entry {
            background: white;
            margin: 20px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .manual-entry h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .table-container {
            background: white;
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        .table th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .table tbody tr:nth-child(even) {
            background-color: #fafbfc;
        }

        .split-bill {
            background-color: #fff3cd !important;
        }

        .full-bill {
            background-color: #d1ecf1 !important;
        }

        .deduction {
            background-color: #d4edda !important;
        }

        .currency {
            text-align: right;
            font-weight: 600;
        }

        .new-entry {
            animation: highlight 3s ease-in-out;
        }

        @keyframes highlight {
            0% { background-color: #fff3cd; }
            100% { background-color: inherit; }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px;
            font-weight: 600;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-weight: 600;
        }

        .debt-amount {
            color: #e74c3c !important;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Real-Time Debt Tracker</h1>
            <p>Live database sync across all devices</p>
        </div>

        <div class="realtime-status" id="realtimeStatus">
            <div class="status-indicator"></div>
            <span>üî¥ Setting up connection...</span>
        </div>

        <div class="debt-banner" id="debtBanner">
            Current Amount Owed: Calculating...
        </div>

        <!-- Setup Section -->
        <div class="setup-section" id="setupSection">
            <h3>üöÄ Get Started</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                <div>
                    <h4>üÜï Create New Shared Room</h4>
                    <p style="margin-bottom: 15px; color: #666;">Start a new debt tracker and get a room code to share with your roommate.</p>
                    <button class="btn btn-primary" onclick="createNewRoom()" style="width: 100%;">Create New Room</button>
                </div>
                
                <div>
                    <h4>üîë Join Existing Room</h4>
                    <p style="margin-bottom: 15px; color: #666;">Enter the room code your roommate shared with you.</p>
                    <input type="text" id="roomCodeInput" placeholder="Enter room code (e.g., DEBT-ABC123)" style="width: 100%; margin-bottom: 10px; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                    <button class="btn btn-success" onclick="joinRoom()" style="width: 100%;">Join Room</button>
                </div>
            </div>
        </div>

        <!-- Room Code Display -->
        <div class="setup-section hidden" id="roomCodeSection">
            <h3>üéâ Room Created Successfully!</h3>
            <div class="room-code-display">
                <p><strong>Share this code with your roommate:</strong></p>
                <div class="room-code" id="roomCodeDisplay">LOADING...</div>
                <button class="btn btn-primary" onclick="copyRoomCode()">üìã Copy Code</button>
            </div>
            <p style="text-align: center; color: #666;">Both of you need to use this same code to sync your debt data in real-time.</p>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="hidden">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value debt-amount" id="totalOwed">$0.00</div>
                    <div class="stat-label">Total Owed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalEntries">0</div>
                    <div class="stat-label">Total Entries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="thisMonth">$0.00</div>
                    <div class="stat-label">This Month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="deductionsTotal">$0.00</div>
                    <div class="stat-label">Total Deductions</div>
                </div>
            </div>

            <div class="manual-entry">
                <h3>‚ûï Add New Bill Entry</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="entryDate">Date</label>
                        <input type="date" id="entryDate" />
                    </div>
                    <div class="form-group">
                        <label for="expenseName">Expense Name</label>
                        <input type="text" id="expenseName" placeholder="e.g., Electric Bill" />
                    </div>
                    <div class="form-group">
                        <label for="expenseValue">Full Amount ($)</label>
                        <input type="number" id="expenseValue" step="0.01" placeholder="0.00" />
                    </div>
                    <div class="form-group">
                        <label for="billType">Bill Type</label>
                        <select id="billType">
                            <option value="">Select type</option>
                            <option value="split">Split in Half</option>
                            <option value="full">You Pay Full</option>
                            <option value="deduction">Deduction (PT/Meals)</option>
                        </select>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-primary" onclick="addEntry()">üíæ Add Entry</button>
                    <button class="btn btn-success" onclick="downloadSpreadsheet()">üì• Download Excel</button>
                    <button class="btn btn-warning" onclick="leaveRoom()">üö™ Leave Room</button>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Expense Name</th>
                            <th>Full Amount</th>
                            <th>Your Portion</th>
                            <th>Type</th>
                            <th>Running Total</th>
                            <th>Added By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="billsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let billsData = [];
        let currentRoomCode = '';
        let runningBalance = 12843;
        let unsubscribe = null;
        let userName = 'You'; // You could make this configurable

        // Initialize the app
        window.addEventListener('load', () => {
            // Check if user was in a room before
            const savedRoom = localStorage.getItem('debtTrackerRoom');
            if (savedRoom) {
                currentRoomCode = savedRoom;
                joinRoom(savedRoom);
            }
            
            // Set default date to today
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
        });

        function createNewRoom() {
            // Generate a unique room code
            const roomCode = 'DEBT-' + Math.random().toString(36).substring(2, 8).toUpperCase();
            currentRoomCode = roomCode;
            
            // Save room code
            localStorage.setItem('debtTrackerRoom', roomCode);
            
            // Show room code to user
            document.getElementById('roomCodeDisplay').textContent = roomCode;
            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('roomCodeSection').classList.remove('hidden');
            
            // Initialize empty room in database
            initializeRoom();
            
            showAlert('üéâ Room created! Share the code with your roommate.', 'success');
        }

        function joinRoom(roomCode = null) {
            const code = roomCode || document.getElementById('roomCodeInput').value.trim().toUpperCase();
            
            if (!code) {
                showAlert('Please enter a room code!', 'warning');
                return;
            }
            
            currentRoomCode = code;
            localStorage.setItem('debtTrackerRoom', code);
            
            // Hide setup sections and show main app
            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('roomCodeSection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Connect to real-time database
            connectToDatabase();
            
            showAlert(`üîó Joined room: ${code}`, 'success');
        }

        function leaveRoom() {
            if (confirm('Are you sure you want to leave this room?')) {
                // Unsubscribe from database updates
                if (unsubscribe) {
                    unsubscribe();
                }
                
                // Clear saved room
                localStorage.removeItem('debtTrackerRoom');
                
                // Reset state
                currentRoomCode = '';
                billsData = [];
                
                // Show setup section
                document.getElementById('setupSection').classList.remove('hidden');
                document.getElementById('roomCodeSection').classList.add('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                
                updateStatus('üî¥ Disconnected');
                showAlert('üëã Left room successfully', 'info');
            }
        }

        function copyRoomCode() {
            const roomCode = document.getElementById('roomCodeDisplay').textContent;
            navigator.clipboard.writeText(roomCode).then(() => {
                showAlert('üìã Room code copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = roomCode;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showAlert('üìã Room code copied!', 'success');
            });
        }

        async function initializeRoom() {
            try {
                // Create initial document for the room
                const { setDoc, doc } = window.firestore;
                await setDoc(doc(window.db, 'rooms', currentRoomCode), {
                    created: new Date().toISOString(),
                    runningBalance: runningBalance
                });
                
                // Connect to the room
                setTimeout(() => {
                    document.getElementById('roomCodeSection').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    connectToDatabase();
                }, 2000);
                
            } catch (error) {
                console.error('Error initializing room:', error);
                showAlert('‚ö†Ô∏è Using demo mode - changes won\'t sync', 'warning');
                
                // Fall back to demo mode
                setTimeout(() => {
                    document.getElementById('roomCodeSection').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    loadDemoData();
                }, 2000);
            }
        }

        function connectToDatabase() {
            try {
                const { onSnapshot, collection, query, orderBy } = window.firestore;
                
                // Listen for real-time updates
                const q = query(
                    collection(window.db, 'rooms', currentRoomCode, 'bills'),
                    orderBy('timestamp', 'asc')
                );
                
                unsubscribe = onSnapshot(q, (snapshot) => {
                    billsData = [];
                    snapshot.forEach((doc) => {
                        billsData.push({ id: doc.id, ...doc.data() });
                    });
                    
                    calculateRunningTotals();
                    updateDisplay();
                    updateStats();
                    updateStatus('üü¢ Real-time sync active');
                }, (error) => {
                    console.error('Database connection error:', error);
                    updateStatus('üî¥ Connection failed - using local mode');
                    loadDemoData();
                });
                
            } catch (error) {
                console.error('Firebase connection error:', error);
                updateStatus('üî¥ Database unavailable - demo mode');
                loadDemoData();
            }
        }

        function loadDemoData() {
            // Load some demo data to show functionality
            billsData = [
                {
                    id: 'demo1',
                    date: '2024-02-01',
                    name: 'Mortgage',
                    fullAmount: 641,
                    yourPortion: 320.50,
                    type: 'split',
                    addedBy: 'Demo',
                    timestamp: new Date('2024-02-01').toISOString()
                },
                {
                    id: 'demo2',
                    date: '2024-02-01',
                    name: 'Electric Bill',
                    fullAmount: 146,
                    yourPortion: 73,
                    type: 'split',
                    addedBy: 'Demo',
                    timestamp: new Date('2024-02-01').toISOString()
                }
            ];
            
            calculateRunningTotals();
            updateDisplay();
            updateStats();
        }

        async function addEntry() {
            const date = document.getElementById('entryDate').value;
            const name = document.getElementById('expenseName').value.trim();
            const fullAmount = parseFloat(document.getElementById('expenseValue').value) || 0;
            const billType = document.getElementById('billType').value;

            if (!date || !name || fullAmount === 0 || !billType) {
                showAlert('Please fill in all fields!', 'warning');
                return;
            }

            let yourPortion = 0;
            switch(billType) {
                case 'split':
                    yourPortion = fullAmount / 2;
                    break;
                case 'full':
                    yourPortion = fullAmount;
                    break;
                case 'deduction':
                    yourPortion = -fullAmount;
                    break;
            }

            const newEntry = {
                date: date,
                name: name,
                fullAmount: fullAmount,
                yourPortion: yourPortion,
                type: billType,
                addedBy: userName,
                timestamp: new Date().toISOString()
            };

            try {
                // Add to Firebase
                const { addDoc, collection } = window.firestore;
                await addDoc(collection(window.db, 'rooms', currentRoomCode, 'bills'), newEntry);
                
                // Clear form
                clearForm();
                showAlert(`‚úÖ ${name} added and synced!`, 'success');
                
            } catch (error) {
                console.error('Error adding entry:', error);
                
                // Fallback to local storage
                newEntry.id = Date.now().toString();
                billsData.push(newEntry);
                calculateRunningTotals();
                updateDisplay();
                updateStats();
                clearForm();
                showAlert(`‚ö†Ô∏è ${name} added locally (sync failed)`, 'warning');
            }
        }

        async function removeEntry(id) {
            try {
                const { deleteDoc, doc } = window.firestore;
                await deleteDoc(doc(window.db, 'rooms', currentRoomCode, 'bills', id));
                showAlert('‚úÖ Entry removed', 'success');
                
            } catch (error) {
                console.error('Error removing entry:', error);
                
                // Fallback to local removal
                billsData = billsData.filter(bill => bill.id !== id);
                calculateRunningTotals();
                updateDisplay();
                updateStats();
                showAlert('‚ö†Ô∏è Entry removed locally', 'warning');
            }
        }

        function clearForm() {
            document.getElementById('expenseName').value = '';
            document.getElementById('expenseValue').value = '';
            document.getElementById('billType').value = '';
        }

        function calculateRunningTotals() {
            let running = runningBalance;
            
            // Sort by timestamp
            billsData.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            billsData.forEach(bill => {
                running += bill.yourPortion;
                bill.runningTotal = running;
            });
        }

        function updateDisplay() {
            const tbody = document.getElementById('billsTableBody');
            tbody.innerHTML = '';

            // Show most recent first in display
            const sortedBills = [...billsData].reverse();

            sortedBills.forEach((bill) => {
                const row = tbody.insertRow();
                
                let rowClass = '';
                switch(bill.type) {
                    case 'split':
                        rowClass = 'split-bill';
                        break;
                    case 'full':
                        rowClass = 'full-bill';
                        break;
                    case 'deduction':
                        rowClass = 'deduction';
                        break;
                }
                
                row.className = rowClass;
                
                // Highlight new entries
                const entryAge = (new Date() - new Date(bill.timestamp)) / 1000;
                if (entryAge < 10) { // Less than 10 seconds old
                    row.classList.add('new-entry');
                }
                
                row.innerHTML = `
                    <td>${formatDateDisplay(bill.date)}</td>
                    <td><strong>${bill.name}</strong></td>
                    <td class="currency">${formatCurrency(bill.fullAmount)}</td>
                    <td class="currency">${formatCurrency(bill.yourPortion)}</td>
                    <td>${bill.type === 'split' ? '‚öñÔ∏è Split' : bill.type === 'full' ? 'üí≥ Full' : 'üí∞ Deduction'}</td>
                    <td class="currency"><strong>${formatCurrency(bill.runningTotal)}</strong></td>
                    <td>${bill.addedBy || 'Unknown'}</td>
                    <td><button class="btn btn-danger" onclick="removeEntry('${bill.id}')" style="padding: 5px 10px; font-size: 0.8rem;">√ó</button></td>
                `;
            });
        }

        function updateStats() {
            const finalBalance = billsData.length > 0 ? billsData[billsData.length - 1].runningTotal : runningBalance;
            
            document.getElementById('debtBanner').textContent = `Current Amount Owed: ${formatCurrency(finalBalance)}`;
            document.getElementById('totalOwed').textContent = formatCurrency(finalBalance);
            document.getElementById('totalEntries').textContent = billsData.length;
            
            // Calculate this month's total
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthTotal = billsData
                .filter(bill => bill.date.startsWith(currentMonth))
                .reduce((sum, bill) => sum + bill.yourPortion, 0);
            document.getElementById('thisMonth').textContent = formatCurrency(monthTotal);
            
            // Calculate total deductions
            const deductions = billsData
                .filter(bill => bill.type === 'deduction')
                .reduce((sum, bill) => sum + Math.abs(bill.yourPortion), 0);
            document.getElementById('deductionsTotal').textContent = formatCurrency(deductions);
        }

        function updateStatus(message) {
            const statusElement = document.getElementById('realtimeStatus');
            const isConnected = message.includes('üü¢');
            
            statusElement.innerHTML = `
                <div class="status-indicator" style="background: ${isConnected ? '#fff' : '#ffccd2'}"></div>
                <span>${message}</span>
            `;
            
            if (isConnected) {
                statusElement.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
            } else {
                statusElement.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            }
        }

        function downloadSpreadsheet() {
            const workbook = XLSX.utils.book_new();
            
            const sheetData = [['Date', 'Expense Name', 'Full Amount', 'Your Portion', 'Type', 'Running Total', 'Added By']];
            billsData.forEach(bill => {
                sheetData.push([
                    bill.date, 
                    bill.name, 
                    bill.fullAmount, 
                    bill.yourPortion, 
                    bill.type, 
                    bill.runningTotal,
                    bill.addedBy || 'Unknown'
                ]);
            });
            
            const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Real-Time Debt Tracker');
            
            XLSX.writeFile(workbook, `Debt_Tracker_${currentRoomCode}_${new Date().toISOString().split('T')[0]}.xlsx`);
            showAlert('üì• Excel file downloaded!', 'success');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function formatDateDisplay(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 4000);
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (unsubscribe) {
                unsubscribe();
            }
        });
    </script>
</body>
</html>
